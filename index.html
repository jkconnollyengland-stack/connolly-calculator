<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Connolly - Shipping Calculator</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script type="module">
        // Firebase imports
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, push, set } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
        import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js';
        
        // Firebase config (using same as SWIS)
        const firebaseConfig = {
            apiKey: "AIzaSyDbd3uX-VfqtLm7v_jkzGzvFD5GFCf8eSw",
            authDomain: "swis-9b0ce.firebaseapp.com",
            databaseURL: "https://swis-9b0ce-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "swis-9b0ce",
            storageBucket: "swis-9b0ce.firebasestorage.app",
            messagingSenderId: "25689930290",
            appId: "1:25689930290:web:a5370855e0dd7104071a2b"
        };
        
        const app = initializeApp(firebaseConfig);
        window.firebaseDb = getDatabase(app);
        window.firebaseStorage = getStorage(app);
        window.firebaseRef = ref;
        window.firebasePush = push;
        window.firebaseSet = set;
        window.storageRef = storageRef;
        window.uploadBytes = uploadBytes;
        window.getDownloadURL = getDownloadURL;
    </script>
    <style>
        * { box-sizing: border-box; }
        body { margin: 0; padding: 0; font-family: 'Gill Sans', 'Gill Sans MT', Calibri, sans-serif; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script>
    const { useState, useMemo, useEffect } = React;
    const e = React.createElement;
    
https://raw.githubusercontent.com/jkconnollyengland-stack/connolly-calculator/main/CB%20Logo%20for%20app.jpg
    const INITIAL_DATA = [{ country:"Australia", category:"FASHION", hts:"6103410000", F:1.05, G:1.2, H:475, boxes:[33.722,42.458,46.163,112.138,69.277], T:16 },
  { country:"Australia", category:"LEATHER GOODS", hts:"42029110", F:1.05, G:1.1, H:475, boxes:[33.722,42.458,46.163,112.138,69.277], T:16 },
  { country:"Australia", category:"ANTIQUES", hts:"97069000", F:1.0, G:1.1, H:475, boxes:[33.722,42.458,46.163,112.138,69.277], T:16 },
  { country:"Australia", category:"ART", hts:"97020000", F:1.05, G:1.0, H:475, boxes:[33.722,42.458,46.163,112.138,69.277], T:16 },
  { country:"Australia", category:"HOMEWARES", hts:"6912002111", F:1.05, G:1.1, H:475, boxes:[33.722,42.458,46.163,112.138,69.277], T:16 },
  { country:"Argentina", category:"FASHION", hts:"6103410000", F:1.35, G:1.2, H:null, boxes:[61.126,81.146,91.117,181.948,119.86], T:16 },
  { country:"Argentina", category:"LEATHER GOODS", hts:"42029110", F:1.2, G:1.2, H:null, boxes:[61.126,81.146,91.117,181.948,119.86], T:16 },
  { country:"Argentina", category:"ANTIQUES", hts:"97069000", F:1.2, G:1.2, H:null, boxes:[61.126,81.146,91.117,181.948,119.86], T:16 },
  { country:"Argentina", category:"ART", hts:"97020000", F:1.05, G:1.2, H:null, boxes:[61.126,81.146,91.117,181.948,119.86], T:16 },
  { country:"Argentina", category:"HOMEWARES", hts:"6912002111", F:1.2, G:1.2, H:null, boxes:[61.126,81.146,91.117,181.948,119.86], T:16 },
  { country:"Brazil", category:"FASHION", hts:"6103410000", F:1.35, G:1.19, H:0, boxes:[61.126,81.146,91.117,181.948,119.86], T:16 },
  { country:"Brazil", category:"LEATHER GOODS", hts:"42029110", F:1.2, G:1.19, H:0, boxes:[61.126,81.146,91.117,181.948,119.86], T:16 },
  { country:"Brazil", category:"ANTIQUES", hts:"97069000", F:1.04, G:1.19, H:0, boxes:[61.126,81.146,91.117,181.948,119.86], T:16 },
  { country:"Brazil", category:"ART", hts:"97020000", F:1.04, G:1.19, H:0, boxes:[61.126,81.146,91.117,181.948,119.86], T:16 },
  { country:"Brazil", category:"HOMEWARES", hts:"6912002111", F:1.0, G:1.19, H:0, boxes:[61.126,81.146,91.117,181.948,119.86], T:16 },
  { country:"Canada", category:"FASHION", hts:"6103410000", F:1.18, G:1.05, H:null, boxes:[23.855,29.718,32.344,79.066,38.636], T:16 },
  { country:"Canada", category:"LEATHER GOODS", hts:"42029110", F:1.0, G:1.05, H:null, boxes:[23.855,29.718,32.344,79.066,38.636], T:16 },
  { country:"Canada", category:"ANTIQUES", hts:"97069000", F:1.0, G:1.0, H:null, boxes:[23.855,29.718,32.344,79.066,38.636], T:16 },
  { country:"Canada", category:"ART", hts:"97020000", F:1.0, G:1.1, H:null, boxes:[23.855,29.718,32.344,79.066,38.636], T:16 },
  { country:"Canada", category:"HOMEWARES", hts:"6912002111", F:1.0, G:1.05, H:null, boxes:[23.855,29.718,32.344,79.066,38.636], T:16 },
  { country:"China", category:"FASHION", hts:"6103410000", F:1.0, G:1.13, H:0, boxes:[33.722,42.458,46.163,112.138,69.277], T:16 },
  { country:"China", category:"LEATHER GOODS", hts:"42029110", F:1.0, G:1.13, H:0, boxes:[33.722,42.458,46.163,112.138,69.277], T:16 },
  { country:"China", category:"ANTIQUES", hts:"97069000", F:1.0, G:1.13, H:0, boxes:[33.722,42.458,46.163,112.138,69.277], T:16 },
  { country:"China", category:"ART", hts:"97020000", F:1.075, G:1.13, H:0, boxes:[33.722,42.458,46.163,112.138,69.277], T:16 },
  { country:"China", category:"HOMEWARES", hts:"6912002111", F:1.0, G:1.13, H:0, boxes:[33.722,42.458,46.163,112.138,69.277], T:16 },
  { country:"France", category:"FASHION", hts:"6103410000", F:1.05, G:1.2, H:0, boxes:[23.192,23.192,23.192,23.192,23.192], T:16 },
  { country:"France", category:"LEATHER GOODS", hts:"42029110", F:1.0, G:1.2, H:0, boxes:[23.192,23.192,23.192,23.192,23.192], T:16 },
  { country:"France", category:"ANTIQUES", hts:"97069000", F:1.055, G:1.055, H:0, boxes:[23.192,23.192,23.192,23.192,23.192], T:16 },
  { country:"France", category:"ART", hts:"97020000", F:1.055, G:1.055, H:0, boxes:[23.192,23.192,23.192,23.192,23.192], T:16 },
  { country:"France", category:"HOMEWARES", hts:"6912002111", F:1.08, G:1.2, H:0, boxes:[23.192,23.192,23.192,23.192,23.192], T:16 },
  { country:"Germany", category:"FASHION", hts:"6103410000", F:1.12, G:1.19, H:0, boxes:[23.192,23.192,23.192,23.192,23.192], T:16 },
  { country:"Germany", category:"LEATHER GOODS", hts:"42029110", F:1.08, G:1.19, H:0, boxes:[23.192,23.192,23.192,23.192,23.192], T:16 },
  { country:"Germany", category:"ANTIQUES", hts:"97069000", F:1.07, G:1.07, H:0, boxes:[23.192,23.192,23.192,23.192,23.192], T:16 },
  { country:"Germany", category:"ART", hts:"97020000", F:1.07, G:1.07, H:0, boxes:[23.192,23.192,23.192,23.192,23.192], T:16 },
  { country:"Germany", category:"HOMEWARES", hts:"6912002111", F:1.0, G:1.19, H:0, boxes:[23.192,23.192,23.192,23.192,23.192], T:16 },
  { country:"Guernsey", category:"FASHION", hts:"6103410000", F:1.0, G:1.0, H:0, boxes:[25.376,25.376,25.376,25.376,25.376], T:16 },
  { country:"Guernsey", category:"LEATHER GOODS", hts:"42029110", F:1.0, G:1.0, H:0, boxes:[25.376,25.376,25.376,25.376,25.376], T:16 },
  { country:"Guernsey", category:"ANTIQUES", hts:"97069000", F:1.0, G:1.0, H:0, boxes:[25.376,25.376,25.376,25.376,25.376], T:16 },
  { country:"Guernsey", category:"ART", hts:"97020000", F:1.0, G:1.0, H:0, boxes:[25.376,25.376,25.376,25.376,25.376], T:16 },
  { country:"Guernsey", category:"HOMEWARES", hts:"6912002111", F:1.0, G:1.0, H:0, boxes:[25.376,25.376,25.376,25.376,25.376], T:16 },
  { country:"Hong Kong", category:"FASHION", hts:"6103410000", F:1.0, G:1.0, H:0, boxes:[33.722,42.458,46.163,112.138,69.277], T:16 },
  { country:"Hong Kong", category:"LEATHER GOODS", hts:"42029110", F:1.0, G:1.0, H:0, boxes:[33.722,42.458,46.163,112.138,69.277], T:16 },
  { country:"Hong Kong", category:"ANTIQUES", hts:"97069000", F:1.0, G:1.0, H:0, boxes:[33.722,42.458,46.163,112.138,69.277], T:16 },
  { country:"Hong Kong", category:"ART", hts:"97020000", F:1.0, G:1.0, H:0, boxes:[33.722,42.458,46.163,112.138,69.277], T:16 },
  { country:"Hong Kong", category:"HOMEWARES", hts:"6912002111", F:1.0, G:1.0, H:0, boxes:[33.722,42.458,46.163,112.138,69.277], T:16 },
  { country:"India", category:"FASHION", hts:"6103410000", F:1.1, G:1.18, H:null, boxes:[43.342,54.6,60.294,104.143,71.825], T:16 },
  { country:"India", category:"LEATHER GOODS", hts:"42029110", F:1.29, G:1.0, H:null, boxes:[43.342,54.6,60.294,104.143,71.825], T:16 },
  { country:"India", category:"ANTIQUES", hts:"97069000", F:1.1, G:1.12, H:null, boxes:[43.342,54.6,60.294,104.143,71.825], T:16 },
  { country:"India", category:"ART", hts:"97020000", F:1.05, G:1.0, H:null, boxes:[43.342,54.6,60.294,104.143,71.825], T:16 },
  { country:"India", category:"HOMEWARES", hts:"6912002111", F:1.29, G:1.0, H:null, boxes:[43.342,54.6,60.294,104.143,71.825], T:16 },
  { country:"Japan", category:"FASHION", hts:"6103410000", F:1.08, G:1.1, H:50, boxes:[33.722,42.458,46.163,112.138,69.277], T:16 },
  { country:"Japan", category:"LEATHER GOODS", hts:"42029110", F:1.01, G:1.1, H:50, boxes:[33.722,42.458,46.163,112.138,69.277], T:16 },
  { country:"Japan", category:"ANTIQUES", hts:"97069000", F:1.0, G:1.0, H:50, boxes:[33.722,42.458,46.163,112.138,69.277], T:16 },
  { country:"Japan", category:"ART", hts:"97020000", F:1.0, G:1.0, H:50, boxes:[33.722,42.458,46.163,112.138,69.277], T:16 },
  { country:"Japan", category:"HOMEWARES", hts:"6912002111", F:1.03, G:1.1, H:50, boxes:[33.722,42.458,46.163,112.138,69.277], T:16 },
  { country:"Jersey", category:"FASHION", hts:"6103410000", F:1.0, G:1.05, H:null, boxes:[25.376,25.376,25.376,25.376,25.376], T:16 },
  { country:"Jersey", category:"LEATHER GOODS", hts:"42029110", F:1.0, G:1.05, H:null, boxes:[25.376,25.376,25.376,25.376,25.376], T:16 },
  { country:"Jersey", category:"ANTIQUES", hts:"97069000", F:1.0, G:1.05, H:null, boxes:[25.376,25.376,25.376,25.376,25.376], T:16 },
  { country:"Jersey", category:"ART", hts:"97020000", F:1.0, G:1.05, H:null, boxes:[25.376,25.376,25.376,25.376,25.376], T:16 },
  { country:"Jersey", category:"HOMEWARES", hts:"6912002111", F:1.0, G:1.05, H:null, boxes:[25.376,25.376,25.376,25.376,25.376], T:16 },
  { country:"Mexico", category:"FASHION", hts:"6103410000", F:1.2, G:1.16, H:null, boxes:[23.855,29.718,32.344,79.066,38.636], T:16 },
  { country:"Mexico", category:"LEATHER GOODS", hts:"42029110", F:1.0, G:1.0, H:null, boxes:[23.855,29.718,32.344,79.066,38.636], T:16 },
  { country:"Mexico", category:"ANTIQUES", hts:"97069000", F:1.0, G:1.0, H:null, boxes:[23.855,29.718,32.344,79.066,38.636], T:16 },
  { country:"Mexico", category:"ART", hts:"97020000", F:1.0, G:1.0, H:null, boxes:[23.855,29.718,32.344,79.066,38.636], T:16 },
  { country:"Mexico", category:"HOMEWARES", hts:"6912002111", F:1.2, G:1.16, H:null, boxes:[23.855,29.718,32.344,79.066,38.636], T:16 },
  { country:"Norway", category:"FASHION", hts:"6103410000", F:1.107, G:1.25, H:25, boxes:[25.376,25.376,25.376,25.376,25.376], T:16 },
  { country:"Norway", category:"LEATHER GOODS", hts:"42029110", F:1.0, G:1.25, H:25, boxes:[25.376,25.376,25.376,25.376,25.376], T:16 },
  { country:"Norway", category:"ANTIQUES", hts:"97069000", F:1.0, G:1.25, H:25, boxes:[25.376,25.376,25.376,25.376,25.376], T:16 },
  { country:"Norway", category:"ART", hts:"97020000", F:1.15, G:1.25, H:25, boxes:[25.376,25.376,25.376,25.376,25.376], T:16 },
  { country:"Norway", category:"HOMEWARES", hts:"6912002111", F:1.0, G:1.25, H:25, boxes:[25.376,25.376,25.376,25.376,25.376], T:16 },
  { country:"Saudi Arabia", category:"FASHION", hts:"6103410000", F:1.1, G:1.15, H:0, boxes:[55.38,73.333,82.303,166.517,108.095], T:16 },
  { country:"Saudi Arabia", category:"LEATHER GOODS", hts:"42029110", F:1.1, G:1.15, H:0, boxes:[55.38,73.333,82.303,166.517,108.095], T:16 },
  { country:"Saudi Arabia", category:"ANTIQUES", hts:"97069000", F:1.1, G:1.15, H:0, boxes:[55.38,73.333,82.303,166.517,108.095], T:16 },
  { country:"Saudi Arabia", category:"ART", hts:"97020000", F:1.1, G:1.15, H:0, boxes:[55.38,73.333,82.303,166.517,108.095], T:16 },
  { country:"Saudi Arabia", category:"HOMEWARES", hts:"6912002111", F:1.1, G:1.15, H:0, boxes:[55.38,73.333,82.303,166.517,108.095], T:16 },
  { country:"Singapore", category:"FASHION", hts:"6103410000", F:1.0, G:1.09, H:null, boxes:[33.722,42.458,46.163,112.138,69.277], T:16 },
  { country:"Singapore", category:"LEATHER GOODS", hts:"42029110", F:1.0, G:1.07, H:null, boxes:[33.722,42.458,46.163,112.138,69.277], T:16 },
  { country:"Singapore", category:"ANTIQUES", hts:"97069000", F:1.0, G:1.09, H:null, boxes:[33.722,42.458,46.163,112.138,69.277], T:16 },
  { country:"Singapore", category:"ART", hts:"97020000", F:1.0, G:1.09, H:null, boxes:[33.722,42.458,46.163,112.138,69.277], T:16 },
  { country:"Singapore", category:"HOMEWARES", hts:"6912002111", F:1.0, G:1.07, H:null, boxes:[33.722,42.458,46.163,112.138,69.277], T:16 },
  { country:"Sweden", category:"FASHION", hts:"6103410000", F:1.0, G:1.25, H:0, boxes:[21.463,21.463,21.463,21.463,21.463], T:16 },
  { country:"Sweden", category:"LEATHER GOODS", hts:"42029110", F:1.0, G:1.25, H:0, boxes:[21.463,21.463,21.463,21.463,21.463], T:16 },
  { country:"Sweden", category:"ANTIQUES", hts:"97069000", F:1.0, G:1.12, H:0, boxes:[21.463,21.463,21.463,21.463,21.463], T:16 },
  { country:"Sweden", category:"ART", hts:"97020000", F:1.0, G:1.12, H:0, boxes:[21.463,21.463,21.463,21.463,21.463], T:16 },
  { country:"Sweden", category:"HOMEWARES", hts:"6912002111", F:1.0, G:1.12, H:0, boxes:[21.463,21.463,21.463,21.463,21.463], T:16 },
  { country:"Switzerland", category:"FASHION", hts:"6103410000", F:1.063, G:1.077, H:0, boxes:[25.376,25.376,25.376,25.376,25.376], T:16 },
  { country:"Switzerland", category:"LEATHER GOODS", hts:"42029110", F:1.063, G:1.077, H:0, boxes:[25.376,25.376,25.376,25.376,25.376], T:16 },
  { country:"Switzerland", category:"ANTIQUES", hts:"97069000", F:1.0, G:1.077, H:0, boxes:[25.376,25.376,25.376,25.376,25.376], T:16 },
  { country:"Switzerland", category:"ART", hts:"97020000", F:1.0, G:1.077, H:0, boxes:[25.376,25.376,25.376,25.376,25.376], T:16 },
  { country:"Switzerland", category:"HOMEWARES", hts:"6912002111", F:1.063, G:1.077, H:0, boxes:[25.376,25.376,25.376,25.376,25.376], T:16 },
  { country:"United Arab Emirates", category:"FASHION", hts:"6103410000", F:1.05, G:1.05, H:63, boxes:[55.38,73.333,82.303,166.517,108.095], T:16 },
  { country:"United Arab Emirates", category:"LEATHER GOODS", hts:"42029110", F:1.05, G:1.05, H:63, boxes:[55.38,73.333,82.303,166.517,108.095], T:16 },
  { country:"United Arab Emirates", category:"ANTIQUES", hts:"97069000", F:1.05, G:1.05, H:63, boxes:[55.38,73.333,82.303,166.517,108.095], T:16 },
  { country:"United Arab Emirates", category:"ART", hts:"97020000", F:1.05, G:1.05, H:63, boxes:[55.38,73.333,82.303,166.517,108.095], T:16 },
  { country:"United Arab Emirates", category:"HOMEWARES", hts:"6912002111", F:1.05, G:1.05, H:63, boxes:[55.38,73.333,82.303,166.517,108.095], T:16 },
  { country:"United States", category:"FASHION", hts:"6103410000", F:1.08, G:1.1, H:null, boxes:[23.855,29.718,32.344,79.066,38.636], T:16 },
  { country:"United States", category:"LEATHER GOODS", hts:"42029110", F:1.08, G:1.15, H:null, boxes:[23.855,29.718,32.344,79.066,38.636], T:16 },
  { country:"United States", category:"ANTIQUES", hts:"97069000", F:1.0, G:1.1, H:null, boxes:[23.855,29.718,32.344,79.066,38.636], T:16 },
  { country:"United States", category:"ART", hts:"97020000", F:1.0, G:1.1, H:null, boxes:[23.855,29.718,32.344,79.066,38.636], T:16 },
  { country:"United States", category:"HOMEWARES", hts:"6912002111", F:1.08, G:1.15, H:null, boxes:[23.855,29.718,32.344,79.066,38.636], T:16 },];
    
    const BOX_LABELS = ["Small", "Medium", "Large", "XL", "XXL"];
    const BOX_DIMS = ["26Ã—20Ã—16cm", "35Ã—27Ã—10cm", "40Ã—32Ã—18cm", "48Ã—40Ã—39cm", "50Ã—50Ã—16cm"];
    const CATEGORIES = ["FASHION", "LEATHER GOODS", "ANTIQUES", "ART", "HOMEWARES"];
    
    function calcTotal(value, row) {
      if (!value || value <= 0) return 0;
      const H = row.H !== null && row.H !== undefined ? row.H : 0;
      const hasAllowance = row.H !== null && row.H !== undefined;
      if (hasAllowance && value <= H) return value + row.T;
      if (hasAllowance && value > H) return ((value - H) * row.G * row.F) + H + row.T;
      return (value * row.G * row.F) + row.T;
    }
    
    const fmt = n => n.toFixed(2);
    
    function App() {
        
        const [adminMode, setAdminMode] = useState(false);
        const [adminPwd, setAdminPwd] = useState("");
        const [editingCell, setEditingCell] = useState(null);
        const [handlingFeeOverride, setHandlingFeeOverride] = useState(() => {
            const saved = localStorage.getItem('connolly-handling-override');
            return saved ? parseFloat(saved) : null;
        });
        const [postageOverride, setPostageOverride] = useState(() => {
            const saved = localStorage.getItem('connolly-postage-override');
            return saved ? parseFloat(saved) : null;
        });

        const [data, setData] = useState(() => {
            // Try to load from localStorage first
            const saved = localStorage.getItem('connolly-calculator-data');
            if (saved) {
                try {
                    return JSON.parse(saved);
                } catch (e) {
                    console.error('Failed to load saved data:', e);
                    return INITIAL_DATA;
                }
            }
            return INITIAL_DATA;
        });
        
        // Save to localStorage whenever data changes
        React.useEffect(() => {
            localStorage.setItem('connolly-calculator-data', JSON.stringify(data));
        }, [data]);
        
        // Save handling fee override to localStorage
        React.useEffect(() => {
            if (handlingFeeOverride === null) {
                localStorage.removeItem('connolly-handling-override');
            } else {
                localStorage.setItem('connolly-handling-override', handlingFeeOverride);
            }
        }, [handlingFeeOverride]);
        
        // Save postage override to localStorage
        React.useEffect(() => {
            if (postageOverride === null) {
                localStorage.removeItem('connolly-postage-override');
            } else {
                localStorage.setItem('connolly-postage-override', postageOverride);
            }
        }, [postageOverride]);
        
        const [country, setCountry] = useState("");
        const [items, setItems] = useState([{ cat: "", val: "" }]);
        const [selectedBox, setSelectedBox] = useState(0);
        
        const countries = useMemo(() => 
            [...new Set(data.map(d => d.country))].sort()
        , [data]);
        
        const addItem = () => setItems([...items, { cat: "", val: "" }]);
        const removeItem = idx => setItems(items.filter((_, i) => i !== idx));
        const updateItem = (idx, field, value) => {
            const newItems = [...items];
            newItems[idx][field] = value;
            setItems(newItems);
        };
        
        const categoryTotals = useMemo(() => {
            if (!country) return {};
            const totals = {};
            items.forEach(item => {
              if (!item.cat || !item.val) return;
              const row = data.find(d => d.country === country && d.category === item.cat);
              if (!row) return;
              const value = parseFloat(item.val) || 0;
              if (value <= 0) return;
              if (!totals[item.cat]) {
                totals[item.cat] = { itemValue: 0, duty: 0, tax: 0, handling: 0, row };
              }
              totals[item.cat].itemValue += value;
            });
            Object.values(totals).forEach(t => {
              const { row, itemValue } = t;
              const hasAllowance = row.H !== null && row.H !== undefined;
              const allowance = hasAllowance ? row.H : 0;
              const taxableAmount = (hasAllowance && itemValue > allowance) ? (itemValue - allowance) : (hasAllowance ? 0 : itemValue);
              t.duty = taxableAmount * (row.F - 1);
              t.tax = (taxableAmount + t.duty) * (row.G - 1);
            });
            return totals;
        }, [country, items, data]);
        
        const handlingFee = useMemo(() => {
            // Use global override if set
            if (handlingFeeOverride !== null) return handlingFeeOverride;
            
            if (!country || Object.keys(categoryTotals).length === 0) return 0;
            const firstRow = data.find(d => d.country === country);
            return firstRow ? firstRow.T : 16;
        }, [country, categoryTotals, data, handlingFeeOverride]);
        
        const grandTotal = useMemo(() => {
            let total = 0;
            Object.values(categoryTotals).forEach(t => {
              total += t.itemValue + t.duty + t.tax;
            });
            return total + handlingFee;
        }, [categoryTotals, handlingFee]);
        
        // Breakdown totals
        const totalGoods = useMemo(() => {
            let total = 0;
            Object.values(categoryTotals).forEach(t => {
                total += t.itemValue;
            });
            return total;
        }, [categoryTotals]);
        
        const totalDuty = useMemo(() => {
            let total = 0;
            Object.values(categoryTotals).forEach(t => {
                total += t.duty;
            });
            return total;
        }, [categoryTotals]);
        
        const totalTax = useMemo(() => {
            let total = 0;
            Object.values(categoryTotals).forEach(t => {
                total += t.tax;
            });
            return total;
        }, [categoryTotals]);
        
        const shippingBoxes = useMemo(() => {
            if (!country) return [];
            const firstRow = data.find(d => d.country === country);
            if (!firstRow) return [];
            
            // If postage override is set, use it for all boxes
            if (postageOverride !== null) {
                return BOX_LABELS.map((label, i) => ({
                    label,
                    dims: BOX_DIMS[i],
                    price: postageOverride,
                    total: grandTotal + postageOverride
                }));
            }
            
            // Otherwise use individual box prices from data
            return firstRow.boxes.map((price, i) => ({
              label: BOX_LABELS[i],
              dims: BOX_DIMS[i],
              price,
              total: grandTotal + price
            }));
        }, [country, grandTotal, data, postageOverride]);
        
        
        
        const saveEdit = (country, category, field, value) => {
            const newData = data.map(row => {
                if (row.country === country && row.category === category) {
                    return { ...row, [field]: parseFloat(value) || value };
                }
                return row;
            });
            setData(newData);
            setEditingCell(null);
        };
        
        const EditableCell = ({ country, category, field, value, label }) => {
            const cellKey = `${country}-${category}-${field}`;
            const isEditing = editingCell === cellKey;
            
            return e('div', {
                style: {
                    display: 'flex',
                    justifyContent: 'space-between',
                    padding: '8px',
                    background: isEditing ? 'rgba(201,169,110,0.2)' : 'rgba(255,255,255,0.05)',
                    borderRadius: '4px',
                    marginBottom: '4px',
                    cursor: adminMode ? 'pointer' : 'default'
                },
                onClick: adminMode ? () => setEditingCell(cellKey) : null
            },
                e('span', { style: { fontSize: '16px', color: '#c9a96e', fontWeight: 600 } }, label),
                isEditing ? 
                    e('input', {
                        type: 'number',
                        step: '0.001',
                        defaultValue: value,
                        autoFocus: true,
                        onBlur: (ev) => saveEdit(country, category, field, ev.target.value),
                        onKeyDown: (ev) => {
                            if (ev.key === 'Enter') saveEdit(country, category, field, ev.target.value);
                            if (ev.key === 'Escape') setEditingCell(null);
                        },
                        style: {
                            width: '100px',
                            padding: '4px 8px',
                            background: '#fff',
                            border: '2px solid #c9a96e',
                            borderRadius: '4px',
                            color: '#000',
                            fontSize: '16px',
                            fontWeight: 600
                        }
                    }) :
                    e('span', { style: { fontSize: '16px', color: '#c9a96e', fontWeight: 600 } }, 
                        typeof value === 'number' ? value.toFixed(3) : value
                    )
            );
        };
        
        // Admin login check
        if (adminMode && adminPwd !== "connolly2025") {
            return e('div', {
                style: {
                    minHeight: '100vh',
                    background: 'linear-gradient(135deg, #0f1724 0%, #1a2332 50%, #162030 100%)',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center'
                }
            },
                e('div', {
                    style: {
                        background: 'rgba(255,255,255,0.05)',
                        borderRadius: '12px',
                        padding: '40px',
                        maxWidth: '400px',
                        border: '1px solid rgba(201,169,110,0.2)'
                    }
                },
                    e('h2', { 
                        style: { 
                            color: '#c9a96e', 
                            fontSize: '27px', 
                            marginBottom: '20px', 
                            textAlign: 'center',
                            fontWeight: 600
                        } 
                    }, 'Admin Access'),
                    e('input', {
                        type: 'password',
                        value: adminPwd,
                        onChange: (ev) => setAdminPwd(ev.target.value),
                        placeholder: 'Enter password',
                        style: {
                            width: '100%',
                            boxSizing: 'border-box',
                            padding: '12px 16px',
                            background: 'rgba(255,255,255,0.06)',
                            border: '1px solid rgba(201,169,110,0.25)',
                            borderRadius: '8px',
                            color: '#c9a96e',
                            fontSize: '22px',
                            outline: 'none',
                            marginBottom: '15px',
                            fontWeight: 600
                        }
                    }),
                    e('button', {
                        onClick: () => {
                            if (adminPwd === "connolly2025") return;
                            alert("Incorrect password");
                        },
                        style: {
                            width: '100%',
                            padding: '12px 20px',
                            background: '#c9a96e',
                            color: '#0f1724',
                            border: 'none',
                            borderRadius: '8px',
                            fontSize: '22px',
                            fontWeight: 600,
                            cursor: 'pointer'
                        }
                    }, 'Access Admin Panel'),
                    e('button', {
                        onClick: () => { setAdminMode(false); setAdminPwd(""); },
                        style: {
                            width: '100%',
                            marginTop: '10px',
                            padding: '12px 20px',
                            background: 'transparent',
                            color: '#c9a96e',
                            border: '1px solid #c9a96e',
                            borderRadius: '8px',
                            fontSize: '21px',
                            cursor: 'pointer',
                            fontWeight: 600
                        }
                    }, 'Back to Calculator')
                )
            );
        }
        
        // Admin panel for editing rates
        if (adminMode && adminPwd === "connolly2025") {
            const selectedCountryData = country ? data.filter(d => d.country === country) : [];
            
            return e('div', {
                style: {
                    minHeight: '100vh',
                    background: 'linear-gradient(135deg, #0f1724 0%, #1a2332 50%, #162030 100%)',
                    color: '#c9a96e',
                    padding: '40px 24px'
                }
            },
                e('div', { style: { maxWidth: '900px', margin: '0 auto' } },
                    e('div', { 
                        style: { 
                            display: 'flex', 
                            justifyContent: 'space-between', 
                            alignItems: 'center', 
                            marginBottom: '30px' 
                        } 
                    },
                        e('h1', { 
                            style: { 
                                fontSize: '36px', 
                                color: '#c9a96e', 
                                margin: 0,
                                fontWeight: 600
                            } 
                        }, 'Admin Panel - Edit Rates'),
                        e('div', { style: { display: 'flex', gap: '12px' } },
                        e('button', {
                            onClick: () => {
                                alert('âœ… All changes are saved automatically!\n\nYour edits are stored in this browser and will persist even after closing the page.');
                            },
                            style: {
                                padding: '8px 20px',
                                background: '#c9a96e',
                                color: '#0f1724',
                                border: 'none',
                                borderRadius: '6px',
                                cursor: 'pointer',
                                fontSize: '21px',
                                fontWeight: 600
                            }
                        }, 'âœ… Auto-Saved'),
                        e('button', {
                            onClick: () => { setAdminMode(false); setAdminPwd(""); },
                            style: {
                                padding: '8px 16px',
                                background: 'rgba(201,169,110,0.2)',
                                color: '#c9a96e',
                                border: '1px solid #c9a96e',
                                borderRadius: '6px',
                                cursor: 'pointer',
                                fontSize: '21px',
                                fontWeight: 600
                            }
                        }, 'Exit Admin'),
                        e('button', {
                            onClick: () => {
                                if (confirm('Reset all data to original values? This cannot be undone.')) {
                                    localStorage.removeItem('connolly-calculator-data');
                                    window.location.reload();
                                }
                            },
                            style: {
                                padding: '8px 20px',
                                background: 'rgba(255,100,100,0.2)',
                                color: '#c9a96e',
                                border: '1px solid rgba(255,100,100,0.5)',
                                borderRadius: '6px',
                                cursor: 'pointer',
                                fontSize: '21px',
                                fontWeight: 600
                            }
                        }, 'ðŸ”„ Reset to Original')
                    )
                    ),
                    
                    // Global Handling Fee Override
                    e('div', {
                        style: {
                            background: 'rgba(201,169,110,0.15)',
                            borderRadius: '12px',
                            border: '2px solid #c9a96e',
                            padding: '28px',
                            marginBottom: '24px'
                        }
                    },
                        e('h2', { style: { fontSize: '24px', marginBottom: '12px', color: '#c9a96e', fontWeight: 600 } }, 'ðŸ’· Global Handling Fee'),
                        e('p', { style: { marginBottom: '20px', color: '#c9a96e', opacity: 0.9, fontSize: '18px' } }, 
                            'Set one handling fee for all countries. Leave empty to use individual country values.'
                        ),
                        e('div', { style: { display: 'flex', gap: '15px', alignItems: 'center', flexWrap: 'wrap' } },
                            e('label', { style: { color: '#c9a96e', fontSize: '20px', fontWeight: 600 } }, 'Handling Fee (Â£):'),
                            e('input', {
                                type: 'number',
                                step: '0.01',
                                min: '0',
                                value: handlingFeeOverride === null ? '' : handlingFeeOverride,
                                onChange: (ev) => {
                                    const val = ev.target.value;
                                    setHandlingFeeOverride(val === '' ? null : parseFloat(val));
                                },
                                placeholder: 'e.g., 15.00',
                                style: {
                                    padding: '14px 18px',
                                    fontSize: '20px',
                                    background: '#fff',
                                    border: '2px solid #c9a96e',
                                    borderRadius: '8px',
                                    color: '#000',
                                    width: '180px',
                                    fontWeight: 600
                                }
                            }),
                            handlingFeeOverride !== null && e('button', {
                                onClick: () => setHandlingFeeOverride(null),
                                style: {
                                    padding: '14px 24px',
                                    background: '#8b7355',
                                    color: '#fff',
                                    border: 'none',
                                    borderRadius: '8px',
                                    cursor: 'pointer',
                                    fontSize: '18px',
                                    fontWeight: 600
                                }
                            }, 'Clear Override')
                        ),
                        handlingFeeOverride !== null && e('div', { 
                            style: { 
                                marginTop: '18px', 
                                padding: '16px',
                                background: 'rgba(201,169,110,0.2)',
                                borderRadius: '8px',
                                color: '#c9a96e', 
                                fontSize: '18px',
                                fontWeight: 600 
                            } 
                        }, `âœ“ Active: All calculations now use Â£${handlingFeeOverride.toFixed(2)} handling fee`)
                    ),
                    
                    // Flat Rate Postage Override
                    e('div', {
                        style: {
                            background: 'rgba(201,169,110,0.15)',
                            borderRadius: '12px',
                            border: '2px solid #c9a96e',
                            padding: '28px',
                            marginBottom: '24px'
                        }
                    },
                        e('h2', { style: { fontSize: '24px', marginBottom: '12px', color: '#c9a96e', fontWeight: 600 } }, 'ðŸ“¦ Flat Rate Postage'),
                        e('p', { style: { marginBottom: '20px', color: '#c9a96e', opacity: 0.9, fontSize: '18px' } }, 
                            'Set one flat postage rate for all box sizes. Leave empty to use individual box prices.'
                        ),
                        e('div', { style: { display: 'flex', gap: '15px', alignItems: 'center', flexWrap: 'wrap' } },
                            e('label', { style: { color: '#c9a96e', fontSize: '20px', fontWeight: 600 } }, 'Postage Rate (Â£):'),
                            e('input', {
                                type: 'number',
                                step: '0.01',
                                min: '0',
                                value: postageOverride === null ? '' : postageOverride,
                                onChange: (ev) => {
                                    const val = ev.target.value;
                                    setPostageOverride(val === '' ? null : parseFloat(val));
                                },
                                placeholder: 'e.g., 25.00',
                                style: {
                                    padding: '14px 18px',
                                    fontSize: '20px',
                                    background: '#fff',
                                    border: '2px solid #c9a96e',
                                    borderRadius: '8px',
                                    color: '#000',
                                    width: '180px',
                                    fontWeight: 600
                                }
                            }),
                            postageOverride !== null && e('button', {
                                onClick: () => setPostageOverride(null),
                                style: {
                                    padding: '14px 24px',
                                    background: '#8b7355',
                                    color: '#fff',
                                    border: 'none',
                                    borderRadius: '8px',
                                    cursor: 'pointer',
                                    fontSize: '18px',
                                    fontWeight: 600
                                }
                            }, 'Clear Override')
                        ),
                        postageOverride !== null && e('div', { 
                            style: { 
                                marginTop: '18px', 
                                padding: '16px',
                                background: 'rgba(201,169,110,0.2)',
                                borderRadius: '8px',
                                color: '#c9a96e', 
                                fontSize: '18px',
                                fontWeight: 600 
                            } 
                        }, `âœ“ Active: All box sizes now cost Â£${postageOverride.toFixed(2)} for shipping`)
                    ),
                    
                    // Country selector for admin
                    e('div', {
                        style: {
                            background: 'rgba(255,255,255,0.04)',
                            borderRadius: '12px',
                            border: '1px solid rgba(201,169,110,0.2)',
                            padding: '28px',
                            marginBottom: '24px'
                        }
                    },
                        e('label', { 
                            style: { 
                                display: 'block', 
                                fontSize: '19px', 
                                color: '#c9a96e', 
                                marginBottom: '6px',
                                fontWeight: 600
                            } 
                        }, 'Select Country to Edit'),
                        e('select', {
                            value: country,
                            onChange: (ev) => setCountry(ev.target.value),
                            style: {
                                width: '100%',
                                height: '46px',
                                padding: '0 14px',
                                background: 'rgba(255,255,255,0.06)',
                                border: '1px solid rgba(201,169,110,0.25)',
                                borderRadius: '8px',
                                color: country ? '#c9a96e' : '#6a635c',
                                fontSize: '22px',
                                cursor: 'pointer',
                                fontWeight: 600
                            }
                        },
                            e('option', { value: '' }, 'â€” Select country â€”'),
                            countries.map(c => e('option', { key: c, value: c }, c))
                        )
                    ),
                    
                    // Rates editor
                    country && e('div', {
                        style: {
                            background: 'rgba(255,255,255,0.04)',
                            borderRadius: '12px',
                            border: '1px solid rgba(201,169,110,0.2)',
                            padding: '28px'
                        }
                    },
                        e('p', { 
                            style: { 
                                fontSize: '19px', 
                                color: '#c9a96e', 
                                marginBottom: '20px',
                                fontWeight: 600
                            } 
                        }, 'Click on any value to edit it. Press Enter to save, Escape to cancel.'),
                        selectedCountryData.map((row, idx) => 
                            e('div', {
                                key: idx,
                                style: {
                                    marginBottom: '20px',
                                    padding: '20px',
                                    background: 'rgba(201,169,110,0.08)',
                                    borderRadius: '8px',
                                    border: '1px solid rgba(201,169,110,0.2)'
                                }
                            },
                                e('h3', { 
                                    style: { 
                                        fontSize: '24px', 
                                        color: '#c9a96e', 
                                        marginBottom: '15px',
                                        fontWeight: 600
                                    } 
                                }, row.category),
                                EditableCell({ 
                                    country: row.country, 
                                    category: row.category, 
                                    field: 'F', 
                                    value: row.F, 
                                    label: 'Duty Rate (F)' 
                                }),
                                EditableCell({ 
                                    country: row.country, 
                                    category: row.category, 
                                    field: 'G', 
                                    value: row.G, 
                                    label: 'Tax Rate (G)' 
                                }),
                                EditableCell({ 
                                    country: row.country, 
                                    category: row.category, 
                                    field: 'H', 
                                    value: row.H, 
                                    label: 'De Minimis (H) Â£' 
                                }),
                                EditableCell({ 
                                    country: row.country, 
                                    category: row.category, 
                                    field: 'T', 
                                    value: row.T, 
                                    label: 'Handling Fee (T) Â£' 
                                })
                            )
                        ),
                    
                    // Box prices editor
                    country && e('div', {
                        style: {
                            marginTop: '30px',
                            background: 'rgba(255,255,255,0.04)',
                            borderRadius: '12px',
                            border: '1px solid rgba(201,169,110,0.2)',
                            padding: '28px'
                        }
                    },
                        e('h2', { 
                            style: { 
                                fontSize: '27px', 
                                color: '#c9a96e', 
                                marginBottom: '15px',
                                fontWeight: 600
                            } 
                        }, 'Shipping Box Prices'),
                        e('p', { 
                            style: { 
                                fontSize: '19px', 
                                color: '#c9a96e', 
                                marginBottom: '20px',
                                fontWeight: 600
                            } 
                        }, 'Click on any box price to edit it.'),
                        selectedCountryData.length > 0 && 
                        e('div', {
                            style: {
                                display: 'grid',
                                gridTemplateColumns: 'repeat(auto-fill, minmax(180px, 1fr))',
                                gap: '15px'
                            }
                        },
                            BOX_LABELS.map((label, i) => {
                                const boxKey = `${selectedCountryData[0].country}-box-${i}`;
                                const isEditing = editingCell === boxKey;
                                const currentPrice = selectedCountryData[0].boxes[i];
                                
                                return e('div', {
                                    key: i,
                                    style: {
                                        padding: '16px',
                                        background: isEditing ? 'rgba(201,169,110,0.2)' : 'rgba(201,169,110,0.08)',
                                        borderRadius: '8px',
                                        border: '1px solid rgba(201,169,110,0.2)',
                                        cursor: 'pointer'
                                    },
                                    onClick: !isEditing ? () => setEditingCell(boxKey) : null
                                },
                                    e('div', { 
                                        style: { 
                                            fontSize: '21px', 
                                            fontWeight: 600, 
                                            color: '#c9a96e', 
                                            marginBottom: '4px' 
                                        } 
                                    }, label),
                                    e('div', { 
                                        style: { 
                                            fontSize: '16px', 
                                            color: '#c9a96e', 
                                            marginBottom: '10px',
                                            fontWeight: 600
                                        } 
                                    }, BOX_DIMS[i]),
                                    isEditing ? 
                                        e('div', { style: { display: 'flex', gap: '8px', marginTop: '8px' } },
                                            e('input', {
                                                type: 'number',
                                                step: '0.01',
                                                defaultValue: currentPrice,
                                                autoFocus: true,
                                                onBlur: (ev) => {
                                                    const newData = data.map(row => {
                                                        if (row.country === selectedCountryData[0].country) {
                                                            const newBoxes = [...row.boxes];
                                                            newBoxes[i] = parseFloat(ev.target.value) || 0;
                                                            return { ...row, boxes: newBoxes };
                                                        }
                                                        return row;
                                                    });
                                                    setData(newData);
                                                    setEditingCell(null);
                                                },
                                                onKeyDown: (ev) => {
                                                    if (ev.key === 'Enter') {
                                                        const newData = data.map(row => {
                                                            if (row.country === selectedCountryData[0].country) {
                                                                const newBoxes = [...row.boxes];
                                                                newBoxes[i] = parseFloat(ev.target.value) || 0;
                                                                return { ...row, boxes: newBoxes };
                                                            }
                                                            return row;
                                                        });
                                                        setData(newData);
                                                        setEditingCell(null);
                                                    }
                                                    if (ev.key === 'Escape') setEditingCell(null);
                                                },
                                                style: {
                                                    width: '100%',
                                                    padding: '6px 10px',
                                                    background: '#fff',
                                                    border: '2px solid #c9a96e',
                                                    borderRadius: '4px',
                                                    color: '#000',
                                                    fontSize: '18px',
                                                    fontWeight: 600
                                                }
                                            })
                                        )
                                    :
                                        e('div', { 
                                            style: { 
                                                fontSize: '24px', 
                                                fontWeight: 700, 
                                                color: '#c9a96e' 
                                            } 
                                        }, 'Â£' + currentPrice.toFixed(2))
                                );
                            })
                        )
                    )
                    )
                )
            );
        }
        
        return e('div', {
            style: {
                minHeight: '100vh',
                background: 'linear-gradient(135deg, #0f1724 0%, #1a2332 50%, #162030 100%)',
                color: '#c9a96e',
                padding: '0'
            }
        }, 
            e('div', { style: { height: '3px', background: 'linear-gradient(90deg, transparent, #c9a96e, transparent)' } }),
            e('div', { style: { maxWidth: '720px', margin: '0 auto', padding: '40px 24px 60px' } },
                e('div', { style: { textAlign: 'center', marginBottom: '30px' } },
e('img', {
                        src: LOGO_URL,
                        alt: 'Connolly',
                        style: { maxWidth: '200px', height: 'auto', display: 'block', margin: '0 auto 20px' }
                    }),
                    e('h1', {
                        style: {
                            fontSize: '42px',
                            fontWeight: 300,
                            letterSpacing: '0.5px',
                            margin: 0,
                            color: '#c9a96e',
                            lineHeight: 1.3
                        }
                    }, 'Duty, Tax & Shipping Calculator'),
                    
                    e('div', { style: { width: '40px', height: '1px', background: '#c9a96e', margin: '16px auto 0' } })
                ),
                
                // Country selection
                e('div', {
                    style: {
                        background: 'rgba(255,255,255,0.04)',
                        borderRadius: '12px',
                        border: '1px solid rgba(201,169,110,0.2)',
                        padding: '28px',
                        marginBottom: '24px'
                    }
                },
                    e('div', { 
                        style: { 
                            fontSize: '16px', 
                            letterSpacing: '3px', 
                            textTransform: 'uppercase', 
                            color: '#c9a96e', 
                            marginBottom: '20px',
                            fontWeight: 600
                        } 
                    }, 'DESTINATION'),
                    e('label', { style: { display: 'block', fontSize: '19px', color: '#c9a96e', marginBottom: '6px', fontWeight: 600 } }, 'Country'),
                    e('select', {
                        value: country,
                        onChange: (ev) => { setCountry(ev.target.value); setItems([{ cat: "", val: "" }]); },
                        style: {
                            width: '100%',
                            height: '46px',
                            paddingLeft: '14px',
                            paddingRight: '36px',
                            background: 'rgba(255,255,255,0.06)',
                            border: '1px solid rgba(201,169,110,0.25)',
                            borderRadius: '8px',
                            color: country ? '#c9a96e' : '#6a635c',
                            fontSize: '22px',
                            outline: 'none',
                            cursor: 'pointer',
                            fontWeight: 600
                        }
                    },
                        e('option', { value: '' }, 'â€” Select destination â€”'),
                        countries.map(c => e('option', { key: c, value: c }, c))
                    )
                ),
                
                // Items section
                country && e('div', {
                    style: {
                        background: 'rgba(255,255,255,0.04)',
                        borderRadius: '12px',
                        border: '1px solid rgba(201,169,110,0.2)',
                        padding: '28px',
                        marginBottom: '24px'
                    }
                },
                    e('div', { 
                        style: { 
                            fontSize: '16px', 
                            letterSpacing: '3px', 
                            textTransform: 'uppercase', 
                            color: '#c9a96e', 
                            marginBottom: '20px',
                            fontWeight: 600
                        } 
                    }, 'ITEMS PURCHASED'),
                    items.map((item, i) => 
                        e('div', {
                            key: i,
                            style: {
                                marginBottom: '16px',
                                padding: '16px',
                                background: 'rgba(201,169,110,0.05)',
                                borderRadius: '8px',
                                border: '1px solid rgba(201,169,110,0.15)'
                            }
                        },
                            e('div', { style: { display: 'flex', gap: '12px', alignItems: 'flex-end' } },
                                e('div', { style: { flex: 1 } },
                                    e('label', { style: { display: 'block', fontSize: '19px', color: '#c9a96e', marginBottom: '6px', fontWeight: 600 } }, 'Category'),
                                    e('select', {
                                        value: item.cat,
                                        onChange: (ev) => updateItem(i, "cat", ev.target.value),
                                        style: {
                                            width: '100%',
                                            height: '46px',
                                            padding: '0 14px',
                                            background: 'rgba(255,255,255,0.06)',
                                            border: '1px solid rgba(201,169,110,0.25)',
                                            borderRadius: '8px',
                                            color: item.cat ? '#c9a96e' : '#6a635c',
                                            fontSize: '22px',
                                            fontWeight: 600,
                                            cursor: 'pointer'
                                        }
                                    },
                                        e('option', { value: '' }, 'â€” Select â€”'),
                                        CATEGORIES.map(c => e('option', { key: c, value: c }, c))
                                    )
                                ),
                                e('div', { style: { flex: 1 } },
                                    e('label', { style: { display: 'block', fontSize: '19px', color: '#c9a96e', marginBottom: '6px', fontWeight: 600 } }, 'Total Export Value (Â£)'),
                                    e('div', { style: { position: 'relative' } },
                                        e('span', { 
                                            style: { 
                                                position: 'absolute', 
                                                left: '14px', 
                                                top: '50%', 
                                                transform: 'translateY(-50%)', 
                                                color: '#c9a96e', 
                                                fontSize: '24px', 
                                                fontWeight: 600 
                                            } 
                                        }, 'Â£'),
                                        e('input', {
                                            type: 'number',
                                            min: '0',
                                            step: '0.01',
                                            value: item.val,
                                            onChange: (ev) => updateItem(i, "val", ev.target.value),
                                            placeholder: '0.00',
                                            style: {
                                                width: '100%',
                                                paddingLeft: '32px',
                                                paddingRight: '16px',
                                                height: '46px',
                                                background: 'rgba(255,255,255,0.06)',
                                                border: '1px solid rgba(201,169,110,0.25)',
                                                borderRadius: '8px',
                                                color: '#c9a96e',
                                                fontSize: '25px',
                                                outline: 'none',
                                                fontWeight: 600
                                            }
                                        })
                                    )
                                ),
                                items.length > 1 && e('button', {
                                    onClick: () => removeItem(i),
                                    style: {
                                        height: '46px',
                                        width: '46px',
                                        background: 'rgba(201,169,110,0.1)',
                                        border: '1px solid rgba(201,169,110,0.25)',
                                        borderRadius: '8px',
                                        color: '#c9a96e',
                                        cursor: 'pointer',
                                        fontSize: '27px',
                                        fontWeight: 600
                                    }
                                }, 'Ã—')
                            )
                        )
                    ),
                    e('button', {
                        onClick: addItem,
                        style: {
                            width: '100%',
                            padding: '12px 20px',
                            background: 'rgba(201,169,110,0.1)',
                            border: '1px solid rgba(201,169,110,0.3)',
                            borderRadius: '8px',
                            color: '#c9a96e',
                            fontSize: '21px',
                            cursor: 'pointer',
                            fontWeight: 600,
                            marginTop: '8px'
                        }
                    }, '+ Add Another Category')
                ),
                
                // Cost breakdown
                Object.keys(categoryTotals).length > 0 && e('div', {
                    style: {
                        background: 'rgba(255,255,255,0.04)',
                        borderRadius: '12px',
                        border: '1px solid rgba(201,169,110,0.2)',
                        padding: '24px 28px',
                        marginBottom: '16px'
                    }
                },
                    e('div', { 
                        style: { 
                            fontSize: '16px', 
                            letterSpacing: '3px', 
                            textTransform: 'uppercase', 
                            color: '#c9a96e', 
                            marginBottom: '16px',
                            fontWeight: 600
                        } 
                    }, 'COST BREAKDOWN'),
                    Object.entries(categoryTotals).map(([cat, t]) => 
                        e('div', {
                            key: cat,
                            style: {
                                marginBottom: '16px',
                                paddingBottom: '12px',
                                borderBottom: '1px solid rgba(255,255,255,0.05)'
                            }
                        },
                            e('div', { style: { fontSize: '19px', color: '#c9a96e', fontWeight: 600, marginBottom: '8px' } }, cat),
                            [
                                ['Item Value', t.itemValue],
                                [`Duty (${((t.row.F - 1) * 100).toFixed(1)}%)`, t.duty],
                                [`Tax (${((t.row.G - 1) * 100).toFixed(1)}%)`, t.tax]
                            ].map(([label, value]) => 
                                e('div', {
                                    key: label,
                                    style: {
                                        display: 'flex',
                                        justifyContent: 'space-between',
                                        alignItems: 'baseline',
                                        padding: '5px 0',
                                        borderBottom: '1px solid rgba(255,255,255,0.05)'
                                    }
                                },
                                    e('span', { 
                                        style: { 
                                            fontSize: '21px', 
                                            color: '#c9a96e',
                                            fontWeight: 600
                                        } 
                                    }, label),
                                    e('span', { 
                                        style: { 
                                            fontSize: '21px', 
                                            color: '#c9a96e',
                                            fontWeight: 600
                                        } 
                                    }, 'Â£' + fmt(value))
                                )
                            )
                        )
                    ),
                    e('div', { style: { borderTop: '1px solid rgba(201,169,110,0.3)', margin: '12px 0 4px' } }),
                    e('div', {
                        style: {
                            display: 'flex',
                            justifyContent: 'space-between',
                            alignItems: 'baseline',
                            padding: '5px 0',
                            borderBottom: '1px solid rgba(255,255,255,0.05)'
                        }
                    },
                        e('span', { 
                            style: { 
                                fontSize: '21px', 
                                color: '#c9a96e',
                                fontWeight: 600
                            } 
                        }, 'Handling Fee'),
                        e('span', { 
                            style: { 
                                fontSize: '21px', 
                                color: '#c9a96e',
                                fontWeight: 600
                            } 
                        }, 'Â£' + fmt(handlingFee))
                    ),
                    
                    // Breakdown totals
                    e('div', { style: { borderTop: '2px solid rgba(201,169,110,0.3)', margin: '12px 0 8px' } }),
                    e('div', {
                        style: {
                            display: 'flex',
                            justifyContent: 'space-between',
                            alignItems: 'baseline',
                            padding: '4px 0'
                        }
                    },
                        e('span', { 
                            style: { 
                                fontSize: '21px', 
                                color: '#c9a96e',
                                fontWeight: 600
                            } 
                        }, 'Total Goods'),
                        e('span', { 
                            style: { 
                                fontSize: '21px', 
                                color: '#c9a96e',
                                fontWeight: 600
                            } 
                        }, 'Â£' + fmt(totalGoods))
                    ),
                    e('div', {
                        style: {
                            display: 'flex',
                            justifyContent: 'space-between',
                            alignItems: 'baseline',
                            padding: '4px 0'
                        }
                    },
                        e('span', { 
                            style: { 
                                fontSize: '21px', 
                                color: '#c9a96e',
                                fontWeight: 600
                            } 
                        }, 'Total Duty'),
                        e('span', { 
                            style: { 
                                fontSize: '21px', 
                                color: '#c9a96e',
                                fontWeight: 600
                            } 
                        }, 'Â£' + fmt(totalDuty))
                    ),
                    e('div', {
                        style: {
                            display: 'flex',
                            justifyContent: 'space-between',
                            alignItems: 'baseline',
                            padding: '4px 0'
                        }
                    },
                        e('span', { 
                            style: { 
                                fontSize: '21px', 
                                color: '#c9a96e',
                                fontWeight: 600
                            } 
                        }, 'Total Tax'),
                        e('span', { 
                            style: { 
                                fontSize: '21px', 
                                color: '#c9a96e',
                                fontWeight: 600
                            } 
                        }, 'Â£' + fmt(totalTax))
                    ),
                    e('div', { style: { borderTop: '1px solid rgba(201,169,110,0.3)', margin: '8px 0 4px' } }),
                    e('div', {
                        style: {
                            display: 'flex',
                            justifyContent: 'space-between',
                            alignItems: 'baseline',
                            padding: '5px 0'
                        }
                    },
                        e('span', { 
                            style: { 
                                fontSize: '22px', 
                                color: '#c9a96e',
                                fontWeight: 600
                            } 
                        }, 'Total Before Shipping'),
                        e('span', { 
                            style: { 
                                fontSize: '27px', 
                                color: '#c9a96e',
                                fontWeight: 700
                            } 
                        }, 'Â£' + fmt(grandTotal))
                    )
                ),
                
                // Box selection
                Object.keys(categoryTotals).length > 0 && e('div', {
                    style: {
                        background: 'rgba(255,255,255,0.04)',
                        borderRadius: '12px',
                        border: '1px solid rgba(201,169,110,0.2)',
                        padding: '24px 28px',
                        marginBottom: '20px'
                    }
                },
                    e('div', { 
                        style: { 
                            fontSize: '16px', 
                            letterSpacing: '3px', 
                            textTransform: 'uppercase', 
                            color: '#c9a96e', 
                            marginBottom: '18px',
                            fontWeight: 600
                        } 
                    }, 'SELECT BOX SIZE'),
                    e('div', { 
                        style: { 
                            display: 'grid', 
                            gridTemplateColumns: 'repeat(auto-fill, minmax(115px, 1fr))', 
                            gap: '10px' 
                        } 
                    },
                        shippingBoxes.map((box, i) => 
                            e('div', {
                                key: i,
                                onClick: () => setSelectedBox(i),
                                style: {
                                    background: i === selectedBox ? 'rgba(201,169,110,0.15)' : 'rgba(201,169,110,0.08)',
                                    borderRadius: '8px',
                                    border: `2px solid ${i === selectedBox ? '#c9a96e' : 'rgba(201,169,110,0.2)'}`,
                                    padding: '14px 10px',
                                    textAlign: 'center',
                                    cursor: 'pointer',
                                    transition: 'all 0.2s'
                                }
                            },
                                e('div', { style: { fontSize: '19px', fontWeight: 600, color: '#c9a96e', marginBottom: '2px' } }, box.label),
                                e('div', { style: { fontSize: '15px', color: '#c9a96e', marginBottom: '8px', fontWeight: 600 } }, box.dims),
                                e('div', { style: { fontSize: '16px', color: '#c9a96e', marginBottom: '2px', fontWeight: 600 } }, 'Shipping: Â£' + fmt(box.price)),
                                e('div', { style: { fontSize: '27px', fontWeight: 600, color: '#c9a96e' } }, 'Â£' + fmt(box.total))
                            )
                        )
                    )
                ),
                
                // Submit Order Button
                (selectedBox !== null && Object.keys(categoryTotals).length > 0) && e('div', {
                    style: {
                        marginTop: '30px',
                        textAlign: 'center'
                    }
                },
                    e('button', {
                        onClick: () => {
                            const orderData = {
                                country,
                                items: items.filter(i => i.cat && i.val),
                                totalGoods,
                                totalDuty,
                                totalTax,
                                handlingFee,
                                grandTotal,
                                boxSize: shippingBoxes[selectedBox].label + ' (' + shippingBoxes[selectedBox].dims + ')',
                                shippingCost: shippingBoxes[selectedBox].price
                            };
                            window.location.href = 'submit-order.html?data=' + encodeURIComponent(JSON.stringify(orderData));
                        },
                        style: {
                            padding: '20px 60px',
                            background: 'linear-gradient(135deg, #c9a96e 0%, #b89860 100%)',
                            color: '#0f1724',
                            border: 'none',
                            borderRadius: '12px',
                            fontSize: '24px',
                            fontWeight: 700,
                            cursor: 'pointer',
                            boxShadow: '0 4px 12px rgba(201,169,110,0.3)',
                            transition: 'transform 0.2s',
                        },
                        onMouseEnter: (e) => e.target.style.transform = 'scale(1.02)',
                        onMouseLeave: (e) => e.target.style.transform = 'scale(1)',
                    }, 'ðŸ“¦ Submit Order to Warehouse')
                ),
                
                // Helper text
                (!country || Object.keys(categoryTotals).length === 0) && e('div', {
                    style: {
                        textAlign: 'center',
                        padding: '28px 0',
                        color: '#c9a96e',
                        fontSize: '21px',
                        fontStyle: 'italic',
                        fontWeight: 600
                    }
                }, !country ? 'Select a destination country to beginâ€¦' : 'Add items above to calculate costs.'),
                
                // Footer info
                e('div', {
                    style: {
                        textAlign: 'center',
                        marginTop: '48px',
                        fontSize: '16px',
                        color: '#c9a96e',
                        lineHeight: 1.7,
                        fontWeight: 600
                    }
                },
                    e('div', { style: { width: '30px', height: '1px', background: '#c9a96e', margin: '0 auto 14px' } }),
                    'All amounts in GBP (Â£). Allowances are in GBP.',
                    e('br'),
                    'Duty and tax are applied to the amount exceeding any de minimis allowance.',
                    e('br'),
                    'Shipping charges are estimates based on standard box sizes.'
                ),
                
                // Admin button at bottom
                e('div', {
                    style: {
                        textAlign: 'center',
                        marginTop: '30px',
                        paddingTop: '20px',
                        borderTop: '1px solid rgba(201,169,110,0.2)'
                    }
                },
                    e('button', {
                        onClick: () => setAdminMode(true),
                        style: {
                            background: 'rgba(201,169,110,0.1)',
                            border: '1px solid rgba(201,169,110,0.3)',
                            color: '#c9a96e',
                            padding: '10px 24px',
                            borderRadius: '6px',
                            cursor: 'pointer',
                            fontSize: '19px',
                            fontWeight: 600
                        }
                    }, 'âš™ Admin Panel')
                )
            )
        );
    }
    
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(e(App));
    </script>
</body>
</html>
